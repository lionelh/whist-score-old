{"ast":null,"code":"import { FormControl, Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/main/services/navigation-notification.service\";\nimport * as i2 from \"src/app/main/services/data.service\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"../../validators/unique-contract-name-and-number-of-players.validator\";\nimport * as i5 from \"@angular/common\";\n\nfunction ContractManagementComponent_tr_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2, \"Aucune annonces trouv\\u00E9 dans la base donn\\u00E9es !\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵattribute(\"colspan\", 4);\n  }\n}\n\nfunction ContractManagementComponent_tr_22_li_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\", 31);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const r_r9 = ctx.$implicit;\n    const j_r10 = ctx.index;\n    i0.ɵɵclassProp(\"bg-warning\", j_r10 % 2 == 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(r_r9.name);\n  }\n}\n\nfunction ContractManagementComponent_tr_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\")(6, \"ul\", 29);\n    i0.ɵɵtemplate(7, ContractManagementComponent_tr_22_li_7_Template, 2, 3, \"li\", 30);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const c_r6 = ctx.$implicit;\n    const i_r7 = ctx.index;\n    i0.ɵɵclassProp(\"bg-info\", i_r7 % 2 == 0);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(c_r6.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(c_r6.numberOfPlayers);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", c_r6.roles);\n  }\n}\n\nfunction ContractManagementComponent_div_36_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 32);\n    i0.ɵɵtext(1, \" Validation en cours... \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ContractManagementComponent_div_37_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Le nom est obligatoire.\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ContractManagementComponent_div_37_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Le nom doit contenir au moins 2 caract\\u00E8res.\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ContractManagementComponent_div_37_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Le nom doit comporter maximum 150 caract\\u00E8res.\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ContractManagementComponent_div_37_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Le nom du r\\u00F4le existe d\\u00E9j\\u00E0.\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ContractManagementComponent_div_37_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 33);\n    i0.ɵɵtemplate(1, ContractManagementComponent_div_37_div_1_Template, 2, 0, \"div\", 9);\n    i0.ɵɵtemplate(2, ContractManagementComponent_div_37_div_2_Template, 2, 0, \"div\", 9);\n    i0.ɵɵtemplate(3, ContractManagementComponent_div_37_div_3_Template, 2, 0, \"div\", 9);\n    i0.ɵɵtemplate(4, ContractManagementComponent_div_37_div_4_Template, 2, 0, \"div\", 9);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.name == null ? null : ctx_r3.name.errors == null ? null : ctx_r3.name.errors[\"required\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.name == null ? null : ctx_r3.name.errors == null ? null : ctx_r3.name.errors[\"minlength\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.name == null ? null : ctx_r3.name.errors == null ? null : ctx_r3.name.errors[\"maxlength\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.name == null ? null : ctx_r3.name.errors == null ? null : ctx_r3.name.errors[\"uniquePlayerName\"]);\n  }\n}\n\nfunction ContractManagementComponent_div_54_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 34)(1, \"input\", 35);\n    i0.ɵɵlistener(\"change\", function ContractManagementComponent_div_54_Template_input_change_1_listener($event) {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return ctx_r16.onRoleCheckboxChange($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"label\", 36);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const r_r15 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"value\", r_r15.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(r_r15.name);\n  }\n}\n\nfunction ContractManagementComponent_div_55_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 33);\n    i0.ɵɵtext(1, \" La s\\u00E9lection des r\\u00F4les est obligatoire. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport let ContractManagementComponent = /*#__PURE__*/(() => {\n  class ContractManagementComponent {\n    constructor(_navigationNotifierService, _dataService, _fb, _uniqueContract) {\n      this._navigationNotifierService = _navigationNotifierService;\n      this._dataService = _dataService;\n      this._fb = _fb;\n      this._uniqueContract = _uniqueContract;\n      this.creationForm = this._fb.group({\n        name: ['', [Validators.required, Validators.minLength(2), Validators.maxLength(150)], []],\n        numberOfPlayers: ['4', [Validators.required]],\n        roles: this._fb.array([], [Validators.required])\n      }, {\n        validators: [],\n        asyncValidators: [this._uniqueContract]\n      });\n    }\n\n    ngOnInit() {\n      this._navigationNotifierService.announcePageChange('contracts');\n\n      this.contracts$ = this._dataService.findAllContracts();\n\n      this._dataService.findAllRoles().subscribe(data => {\n        this.rolesArray = data;\n      });\n    }\n\n    get name() {\n      var _a;\n\n      return (_a = this.creationForm) === null || _a === void 0 ? void 0 : _a.get('name');\n    }\n\n    get roles() {\n      var _a;\n\n      return (_a = this.creationForm) === null || _a === void 0 ? void 0 : _a.get('roles');\n    }\n\n    findRoleById(inId) {\n      var _a;\n\n      let found = undefined;\n      (_a = this.rolesArray) === null || _a === void 0 ? void 0 : _a.forEach(item => {\n        if (item.id == inId) {\n          found = item;\n        }\n      });\n      return found;\n    }\n\n    onSubmit() {\n      var _a, _b, _c, _d;\n\n      if ((_a = this.creationForm) === null || _a === void 0 ? void 0 : _a.valid) {\n        let c = {\n          name: (_b = this.creationForm) === null || _b === void 0 ? void 0 : _b.value['name'],\n          numberOfPlayers: (_c = this.creationForm) === null || _c === void 0 ? void 0 : _c.value['numberOfPlayers'],\n          roles: []\n        };\n        const rolesTab = this.creationForm.get('roles');\n        rolesTab.controls.forEach(item => {\n          var _a;\n\n          let roleId = item.value;\n          let r = this.findRoleById(roleId);\n\n          if (r !== undefined) {\n            (_a = c.roles) === null || _a === void 0 ? void 0 : _a.push(r);\n          }\n        });\n\n        this._dataService.createContract(c).subscribe(() => {\n          this.contracts$ = this._dataService.findAllContracts();\n        });\n\n        this.creationForm.reset();\n        this.roles.clear();\n        (_d = this.creationForm.get('numberOfPlayers')) === null || _d === void 0 ? void 0 : _d.setValue('4');\n      }\n    }\n\n    onRoleCheckboxChange(e) {\n      let eventTarget = e.target;\n      const rolesArray = this.creationForm.get('roles');\n\n      if (eventTarget.checked) {\n        rolesArray.push(new FormControl(eventTarget.value));\n      } else {\n        let i = 0;\n        rolesArray.controls.forEach(item => {\n          if (item.value == (eventTarget === null || eventTarget === void 0 ? void 0 : eventTarget.value)) {\n            rolesArray.removeAt(i);\n            return;\n          }\n\n          i++;\n        });\n      }\n    }\n\n  }\n\n  ContractManagementComponent.ɵfac = function ContractManagementComponent_Factory(t) {\n    return new (t || ContractManagementComponent)(i0.ɵɵdirectiveInject(i1.NavigationNotifierService), i0.ɵɵdirectiveInject(i2.DataService), i0.ɵɵdirectiveInject(i3.FormBuilder), i0.ɵɵdirectiveInject(i4.UniqueContractByNameAndNumberOfPlayersValidator));\n  };\n\n  ContractManagementComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ContractManagementComponent,\n    selectors: [[\"wsw-contract-management\"]],\n    decls: 61,\n    vars: 18,\n    consts: [[1, \"container\"], [1, \"row\"], [1, \"col\"], [1, \"card\", \"text-white\", \"border-primary\"], [1, \"card-header\", \"bg-primary\"], [1, \"card-body\"], [1, \"card-text\"], [1, \"table\", \"table-bordered\", \"table-stripped\"], [1, \"bg-primary\", \"text-white\"], [4, \"ngIf\"], [3, \"bg-info\", 4, \"ngFor\", \"ngForOf\"], [1, \"card-body\", \"text-black\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"form-group\", \"required\"], [\"for\", \"name\", 1, \"control-label\"], [\"id\", \"name\", \"type\", \"text\", \"formControlName\", \"name\", 1, \"form-control\"], [1, \"form-helper\"], [\"class\", \"text-warning\", 4, \"ngIf\"], [\"class\", \"invalid-feedback\", 4, \"ngIf\"], [1, \"form-group\"], [\"for\", \"numberOfPlayers\", 1, \"control-label\"], [\"color\", \"red\"], [\"id\", \"four\", \"type\", \"radio\", \"value\", \"4\", \"name\", \"numberOfPlayers\", \"formControlName\", \"numberOfPlayers\", 1, \"custom-control-input\"], [\"for\", \"four\", 1, \"custom-control-label\"], [\"id\", \"five\", \"type\", \"radio\", \"value\", \"5\", \"name\", \"numberOfPlayers\", \"formControlName\", \"numberOfPlayers\", 1, \"custom-control-input\"], [\"for\", \"five\", 1, \"custom-control-label\"], [\"for\", \"roles\", 1, \"control-label\"], [\"class\", \"form-check\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", 3, \"disabled\"], [1, \"list-group\"], [\"class\", \"list-group-item\", 3, \"bg-warning\", 4, \"ngFor\", \"ngForOf\"], [1, \"list-group-item\"], [1, \"text-warning\"], [1, \"invalid-feedback\"], [1, \"form-check\"], [\"type\", \"checkbox\", 1, \"form-check-input\", 3, \"value\", \"change\"], [1, \"form-check-label\"]],\n    template: function ContractManagementComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h1\");\n        i0.ɵɵtext(4, \"Gestion des annonces\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(5, \"div\", 1)(6, \"div\", 2)(7, \"div\", 3)(8, \"div\", 4);\n        i0.ɵɵtext(9, \"Liste des anonces\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"div\", 5)(11, \"div\", 6)(12, \"table\", 7)(13, \"tr\", 8)(14, \"th\");\n        i0.ɵɵtext(15, \"Nom du l'annonce\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"th\");\n        i0.ɵɵtext(17, \"Nombre de jouer de la donne\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"th\");\n        i0.ɵɵtext(19, \"R\\u00F4les des participants \\u00E0 la donne\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(20, ContractManagementComponent_tr_20_Template, 3, 1, \"tr\", 9);\n        i0.ɵɵpipe(21, \"async\");\n        i0.ɵɵtemplate(22, ContractManagementComponent_tr_22_Template, 8, 5, \"tr\", 10);\n        i0.ɵɵpipe(23, \"async\");\n        i0.ɵɵelementEnd()()()()();\n        i0.ɵɵelementStart(24, \"div\", 2)(25, \"div\", 3)(26, \"div\", 4);\n        i0.ɵɵtext(27, \"Cr\\u00E9ation d'une annonce\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(28, \"div\", 11)(29, \"div\", 6)(30, \"form\", 12);\n        i0.ɵɵlistener(\"ngSubmit\", function ContractManagementComponent_Template_form_ngSubmit_30_listener() {\n          return ctx.onSubmit();\n        });\n        i0.ɵɵelementStart(31, \"div\", 13)(32, \"label\", 14);\n        i0.ɵɵtext(33, \"Nom de l'annonce\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(34, \"input\", 15)(35, \"div\", 16);\n        i0.ɵɵtemplate(36, ContractManagementComponent_div_36_Template, 2, 0, \"div\", 17);\n        i0.ɵɵtemplate(37, ContractManagementComponent_div_37_Template, 5, 4, \"div\", 18);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(38, \"fieldset\", 19)(39, \"label\", 20);\n        i0.ɵɵtext(40, \"Nombre de joueurs participants \\u00E0 la partie\");\n        i0.ɵɵelementStart(41, \"font\", 21);\n        i0.ɵɵtext(42, \"*\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(43, \"div\");\n        i0.ɵɵelement(44, \"input\", 22);\n        i0.ɵɵelementStart(45, \"label\", 23);\n        i0.ɵɵtext(46, \"\\u00A04\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(47, \"div\");\n        i0.ɵɵelement(48, \"input\", 24);\n        i0.ɵɵelementStart(49, \"label\", 25);\n        i0.ɵɵtext(50, \"\\u00A05\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(51, \"fieldset\", 19)(52, \"label\", 26);\n        i0.ɵɵtext(53, \"R\\u00F4les des joueurs participants \\u00E0 la partie\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(54, ContractManagementComponent_div_54_Template, 4, 2, \"div\", 27);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(55, ContractManagementComponent_div_55_Template, 2, 0, \"div\", 18);\n        i0.ɵɵelementStart(56, \"div\", 19)(57, \"fieldset\")(58, \"button\", 28);\n        i0.ɵɵtext(59, \"Enregistrer\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelement(60, \"br\");\n        i0.ɵɵelementEnd()()()()()();\n      }\n\n      if (rf & 2) {\n        let tmp_0_0;\n        i0.ɵɵadvance(20);\n        i0.ɵɵproperty(\"ngIf\", ((tmp_0_0 = i0.ɵɵpipeBind1(21, 14, ctx.contracts$)) == null ? null : tmp_0_0.length) == 0);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(23, 16, ctx.contracts$));\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"formGroup\", ctx.creationForm);\n        i0.ɵɵadvance(1);\n        i0.ɵɵclassProp(\"has-danger\", (ctx.name == null ? null : ctx.name.invalid) && ((ctx.name == null ? null : ctx.name.dirty) || (ctx.name == null ? null : ctx.name.touched)));\n        i0.ɵɵadvance(3);\n        i0.ɵɵclassProp(\"is-invalid\", (ctx.name == null ? null : ctx.name.invalid) && ((ctx.name == null ? null : ctx.name.dirty) || (ctx.name == null ? null : ctx.name.touched)))(\"is-valid\", (ctx.name == null ? null : ctx.name.valid) && ((ctx.name == null ? null : ctx.name.dirty) || (ctx.name == null ? null : ctx.name.touched)));\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ((ctx.name == null ? null : ctx.name.dirty) || (ctx.name == null ? null : ctx.name.touched)) && (ctx.name == null ? null : ctx.name.status) === \"PENDING\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", (ctx.name == null ? null : ctx.name.invalid) && ((ctx.name == null ? null : ctx.name.dirty) || (ctx.name == null ? null : ctx.name.touched)));\n        i0.ɵɵadvance(17);\n        i0.ɵɵproperty(\"ngForOf\", ctx.rolesArray);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.creationForm.controls[\"roles\"].errors == null ? null : ctx.creationForm.controls[\"roles\"].errors[\"required\"]);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"disabled\", !(ctx.creationForm == null ? null : ctx.creationForm.valid));\n      }\n    },\n    directives: [i5.NgIf, i5.NgForOf, i3.ɵNgNoValidate, i3.NgControlStatusGroup, i3.FormGroupDirective, i3.DefaultValueAccessor, i3.NgControlStatus, i3.FormControlName, i3.RadioControlValueAccessor],\n    pipes: [i5.AsyncPipe],\n    styles: [\"\"]\n  });\n  return ContractManagementComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}